<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>신용카드 도움말 - 금융거래 통합정보</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', '맑은 고딕', sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1920px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h1 {
            color: #333;
            margin-bottom: 30px;
            font-size: 2em;
        }

        h2 {
            color: #FF9800;
            margin-top: 30px;
            margin-bottom: 15px;
            font-size: 1.5em;
            border-bottom: 2px solid #FF9800;
            padding-bottom: 10px;
        }

        h3 {
            color: #555;
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .help-section {
            margin-bottom: 30px;
        }

        .help-section p {
            line-height: 1.8;
            color: #666;
            margin-bottom: 10px;
        }

        .help-section ul {
            margin-left: 20px;
            margin-bottom: 15px;
        }

        .help-section li {
            line-height: 1.8;
            color: #666;
            margin-bottom: 5px;
        }

        .code-block {
            background: #f8f9fa;
            border-left: 4px solid #FF9800;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
        }

        .help-section code {
            background: #f0f0f0;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .feature-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .feature-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #FF9800;
        }

        .feature-card h4 {
            color: #FF9800;
            margin-bottom: 10px;
        }

        /* 반응형 디자인 */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 1.5em;
            }

            h2 {
                font-size: 1.3em;
            }

            .feature-list {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- 신용카드 통합정보 네비게이터 -->
    <nav class="main-nav">
        <a href="/" class="nav-item">🏠 홈</a>
        <a href="/card/" class="nav-item">💳 신용카드 전처리</a>
        <a href="/card/category" class="nav-item">🏷️ 신용카드 카테고리</a>
        <a href="/card/analysis/basic" class="nav-item">📊 신용카드 기본분석</a>
        <a href="/card/help" class="nav-item active">❓ 신용카드 도움말</a>
    </nav>

    <div class="container">
        <h1>❓ 신용카드 도움말</h1>

        <div class="help-section">
            <h2>시작하기</h2>
            <p>신용카드 통합정보(MyCard)는 <strong>국민·신한·현대·하나</strong> 등 여러 카드사의 거래 내역을 하나로 모아 통합 관리하는 시스템입니다. 전처리 → 카테고리 분류 → 분석 순으로 사용합니다.</p>
            <h3>서버 실행</h3>
            <p>프로젝트 루트에서 <code>start-server.bat</code>을 실행하거나, 터미널에서 <code>python app.py</code>를 실행한 뒤 브라우저로 접속합니다.</p>
            <div class="code-block">cd MyInfo 경로
python app.py</div>
            <p>기본 주소는 <strong>http://localhost:5000</strong>입니다. 신용카드 전처리는 <strong>/card/</strong>, 카테고리는 <strong>/card/category</strong>, 기본분석은 <strong>/card/analysis/basic</strong>입니다.</p>
            <h3>폴더 구조</h3>
            <p>신용카드 관련 파일은 모두 <strong>MyCard</strong> 폴더 안에서 다룹니다.</p>
            <ul>
                <li><strong>MyInfo/.source/Card</strong>: 각 카드사에서 내려받은 거래 내역 원본(.xls, .xlsx)을 넣는 폴더입니다. 파일명에 <strong>국민카드</strong>, <strong>신한카드</strong>, <strong>현대카드</strong>, <strong>하나카드</strong>가 포함되어야 인식합니다.</li>
                <li><strong>card_before.xlsx</strong>: 전처리 결과가 MyInfo/.source에 저장됩니다. .source/Card 파일들을 통합·표준화한 결과입니다. 컬럼: 카드사, 카드번호, 이용일, 이용시간(승인시간), 입금액, 출금액, 취소, 가맹점명, 사업자번호, 구분</li>
                <li><strong>category_table.json</strong>: 카테고리 분류 규칙(분류, 키워드, 카테고리)이 저장되는 파일입니다. 계정과목 등으로 가맹점명 기반 자동 분류를 지원합니다.</li>
                <li><strong>card_after.xlsx</strong>: 카테고리를 적용한 최종 거래 데이터입니다. 기본분석은 이 파일을 사용합니다.</li>
            </ul>
        </div>

        <div class="help-section">
            <h2>지원 카드사 및 파일 형식</h2>
            <p>MyInfo/.source/Card에는 <strong>.xls</strong> 또는 <strong>.xlsx</strong> 파일만 사용합니다. PDF 등 다른 형식은 지원하지 않습니다.</p>
            <ul>
                <li><strong>국민카드</strong>: .xls, .xlsx 지원</li>
                <li><strong>신한카드</strong>: .xls, .xlsx 지원</li>
                <li><strong>현대카드</strong>: .xls, .xlsx 지원</li>
                <li><strong>하나카드</strong>: .xls, .xlsx 지원</li>
            </ul>
            <p>파일명 예: <code>국민카드_김찬식_2021-2025.xlsx</code>, <code>신한카드_김찬식_2024.xlsx</code>, <code>현대카드_김찬식_2021-2025.xlsx</code>, <code>하나카드_김찬식_2024-2025.xlsx</code></p>
            <p>카드사명은 파일명의 첫 번째 <code>_</code> 앞 부분에서 자동으로 추출됩니다. 예: <code>신한카드_김찬식_2024.xlsx</code> → 카드사 = "신한카드"</p>
        </div>

        <div class="help-section">
            <h2>주요 기능</h2>
            <div class="feature-list">
                <div class="feature-card">
                    <h4>📊 전처리</h4>
                    <p>MyInfo/.source/Card의 .xls/.xlsx를 읽어 표준 컬럼으로 통합합니다. 카드사는 파일명에서, 구분 0은 공백으로 저장됩니다. MyInfo/.source/card_before.xlsx로 저장됩니다.</p>
                </div>
                <div class="feature-card">
                    <h4>🏷️ 카테고리</h4>
                    <p>분류(계정과목 등)와 키워드 기반 자동 분류를 지원합니다. 가맹점명에 키워드가 포함되면 해당 카테고리가 부여됩니다. category_table.json를 수정한 뒤 "카테고리 적용"으로 card_after.xlsx를 갱신합니다.</p>
                </div>
                <div class="feature-card">
                    <h4>📈 기본분석</h4>
                    <p>전체 통계, 가맹점별·월별·카드사별·카드별 요약, 차트를 통해 거래 패턴을 빠르게 파악합니다.</p>
                </div>
            </div>
        </div>

        <div class="help-section">
            <h2>카테고리 체계</h2>
            <p>신용카드 카테고리는 <strong>계정과목</strong> 등으로 구성됩니다.</p>
            <ul>
                <li><strong>계정과목</strong>: 지출 항목별 분류(외식, 의료비, 교통비, 주거비 등). 가맹점명에 키워드가 포함되면 해당 카테고리가 적용됩니다. 여러 키워드는 <code>/</code>로 OR 조건 지정(예: 파리바게뜨/베이커리).</li>
            </ul>
            <p>"카테고리 생성"은 card_before 기준으로 기본 규칙을 자동 생성하고, "카테고리 적용"은 그 규칙으로 card_after를 만듭니다. 규칙은 category_table.json에서 수동 수정 가능합니다.</p>
        </div>

        <div class="help-section">
            <h2>페이지별 사용법</h2>
            
            <h3>신용카드 전처리 (/card/)</h3>
            <ul>
                <li>MyInfo/.source/Card에 국민/신한/현대/하나 카드사 거래 내역 .xls 또는 .xlsx를 넣습니다.</li>
                <li>전처리 페이지에서 <strong>"전처리 실행"</strong> 버튼을 클릭합니다. 서버가 .source/Card를 읽어 통합하고, MyInfo/.source에 card_before.xlsx·card_after.xlsx를 생성·갱신합니다. 카테고리 규칙은 MyInfo/category_table.json(신용카드 구분)를 사용합니다.</li>
                <li>전처리 전/후 데이터를 테이블로 비교할 수 있습니다. <strong>카드사</strong>, <strong>년·월</strong> 등 필터로 범위를 줄여 확인하세요.</li>
                <li>데이터가 없으면 "MyInfo/.source/Card에 .xls/.xlsx가 있는지", "파일명에 카드사명이 포함되는지"를 확인합니다.</li>
            </ul>

            <h3>신용카드 카테고리 (/card/category)</h3>
            <ul>
                <li><strong>카테고리 테이블</strong>: 분류, 키워드, 카테고리 컬럼으로 구성됩니다. 행 추가·삭제·수정으로 규칙을 관리합니다.</li>
                <li><strong>"카테고리 생성"</strong>: card_before.xlsx를 기준으로 계정과목 등 규칙을 자동 생성합니다. 기존 category_table.json의 신용카드 섹션이 있으면 갱신되므로, 필요 시 백업 후 실행하세요.</li>
                <li><strong>"카테고리 적용"</strong>: 현재 카테고리 테이블 규칙을 card_before에 적용해 card_after.xlsx를 생성·갱신합니다. 적용 후 "카테고리 적용후" 섹션에서 데이터 미리보기로 결과를 확인할 수 있습니다.</li>
                <li><strong>카드사 필터·📄 출력</strong>: 페이지 헤더의 "카드사" 드롭다운으로 특정 카드사만 보거나, "📄 출력" 버튼으로 현재 화면을 인쇄·PDF 저장할 수 있습니다.</li>
                <li>카테고리별 통계, 월별 추이, 카테고리 그래프 등도 이 페이지에서 확인할 수 있습니다.</li>
            </ul>

            <h3>신용카드 기본분석 (/card/analysis/basic)</h3>
            <ul>
                <li><strong>전체 통계</strong>: 거래건수, 입금건수, 출금건수, 입금합계, 출금합계, 순잔액을 한눈에 확인합니다.</li>
                <li><strong>가맹점별 분석</strong>: 가맹점(거래점)별 입금·출금·차액을 표시합니다. 행을 클릭하면 해당 가맹점의 상세 거래 내역이 나타납니다.</li>
                <li><strong>입금/출금/차액 그래프</strong>: 가맹점별 입금·출금·차액을 막대 차트로 비교합니다.</li>
                <li><strong>카드사별/카드별 집계</strong>: 카드사·카드번호 단위 집계와 파이 차트를 제공합니다.</li>
                <li><strong>카드사 필터</strong>: 헤더의 "카드사" 드롭다운으로 특정 카드사만 분석할 수 있습니다.</li>
            </ul>

        </div>

        <div class="help-section">
            <h2>문제 해결</h2>
            
            <h3>데이터가 표시되지 않음</h3>
            <ul>
                <li><strong>MyInfo/.source/Card</strong>에 .xls 또는 .xlsx 파일이 있는지 확인하세요. 파일명에 국민카드/신한카드/현대카드/하나카드가 들어가야 합니다.</li>
                <li>전처리를 실행한 뒤 <strong>card_before.xlsx</strong>가 MyInfo/.source에 생성되었는지 확인하세요. 파일이 비어 있거나 Excel 등에서 열려 있으면 읽기 실패할 수 있습니다.</li>
                <li>브라우저 개발자 도구(F12) → Console 탭에서 오류 메시지를 확인하세요. API 오류 시 서버 터미널 로그도 함께 확인합니다.</li>
            </ul>

            <h3>카테고리·card_after가 생성/적용되지 않음</h3>
            <ul>
                <li><strong>category_table.json</strong>가 MyInfo(프로젝트 루트)에 있는지 확인하세요. 없으면 카테고리 페이지에서 "카테고리 생성"을 먼저 실행합니다.</li>
                <li>"카테고리 적용" 전에 카테고리 테이블에 필요한 규칙(분류, 키워드, 카테고리)이 들어 있는지 확인하세요.</li>
                <li><strong>card_after.xlsx</strong>를 Excel 등에서 열어둔 상태면 쓰기 오류가 날 수 있습니다. 파일을 닫은 뒤 다시 "카테고리 적용"을 실행하세요.</li>
            </ul>

            <h3>전처리·통합 오류</h3>
            <ul>
                <li>원본 파일이 해당 카드사 표준 형식(이용일, 가맹점명, 입금액/출금액 등 필수 컬럼 포함)인지 확인하세요. 헤더 행이 정상 인식되지 않으면 데이터가 출력되지 않습니다.</li>
                <li>인코딩은 UTF-8 또는 CP949를 사용합니다. 한글이 깨지면 저장 시 인코딩을 바꿔 다시 시도해 보세요.</li>
                <li>카드사가 매칭되지 않으면 파일명이 <code>카드사_기타.xlsx</code> 형식인지 확인하세요. 첫 번째 <code>_</code> 앞이 카드사명으로 사용됩니다.</li>
            </ul>

            <h3>서버 연결·실행 오류</h3>
            <ul>
                <li>서버가 실행 중인지 확인하세요. <code>python app.py</code> 또는 <code>start-server.bat</code>으로 띄웁니다.</li>
                <li>포트 5000이 다른 프로그램에서 사용 중이면 연결이 안 될 수 있습니다.</li>
                <li>방화벽에서 localhost:5000 접속이 차단되지 않았는지 확인하세요.</li>
            </ul>
        </div>

        <div class="help-section">
            <h2>접속 주소</h2>
            <ul>
                <li><strong>홈페이지:</strong> http://localhost:5000</li>
                <li><strong>금융거래 도움말:</strong> http://localhost:5000/help</li>
                <li><strong>신용카드 전처리:</strong> http://localhost:5000/card/</li>
                <li><strong>신용카드 카테고리:</strong> http://localhost:5000/card/category</li>
                <li><strong>신용카드 기본분석:</strong> http://localhost:5000/card/analysis/basic</li>
                <li><strong>신용카드 도움말:</strong> http://localhost:5000/card/help</li>
            </ul>
        </div>
    </div>

    <style>
        .main-nav {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            padding: 10px;
            background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            max-width: 1920px;
            margin-left: auto;
            margin-right: auto;
        }

        .nav-item {
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            text-decoration: none;
            border-radius: 5px;
            font-weight: bold;
            font-size: 14px;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 120px;
            text-align: center;
            white-space: nowrap;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 1);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .nav-item.active {
            background: #2196F3;
            color: white;
        }

        @media (max-width: 768px) {
            .main-nav {
                gap: 3px;
                padding: 8px;
            }
            
            .nav-item {
                font-size: 11px;
                padding: 6px 8px;
                min-width: 80px;
                flex: 1 1 calc(50% - 3px);
            }
        }
    </style>
    <script>
    // 현재 페이지에 따라 active 클래스 추가
    document.addEventListener('DOMContentLoaded', function() {
        const currentPath = window.location.pathname;
        const navItems = document.querySelectorAll('.nav-item');
        
        // 먼저 모든 active 클래스 제거
        navItems.forEach(item => {
            item.classList.remove('active');
        });
        
        // 현재 페이지에 맞는 항목에 active 클래스 추가
        // 가장 구체적인 매칭을 찾기 위해 href 길이로 정렬 (긴 것부터)
        const sortedNavItems = Array.from(navItems).sort((a, b) => {
            const hrefA = a.getAttribute('href');
            const hrefB = b.getAttribute('href');
            return hrefB.length - hrefA.length;
        });
        
        // 모든 가능한 매칭을 찾기
        const matches = [];
        for (const item of sortedNavItems) {
            const href = item.getAttribute('href');
            
            // 정확히 일치하는 경우 (최우선)
            if (href === currentPath) {
                matches.push({ item, priority: 1, href });
                continue;
            }
            
            // /bank/ 또는 /card/의 경우 정확히 일치해야 함 (다른 경로로 시작하는 경우 제외)
            if (href === '/bank/' || href === '/card/') {
                if (currentPath === href || currentPath === href.slice(0, -1)) {
                    matches.push({ item, priority: 3, href });
                }
                // /card/help 같은 경우는 /card/와 매칭되지 않음
                continue;
            }
            
            // 다른 경로들은 startsWith로 매칭 (단, /bank/ 또는 /card/로 시작하는 경우는 제외)
            if (href !== '/' && currentPath.startsWith(href)) {
                matches.push({ item, priority: 2, href });
            }
        }
        
        // 가장 구체적인 매칭만 active로 설정 (priority가 낮을수록 우선순위 높음)
        if (matches.length > 0) {
            matches.sort((a, b) => {
                if (a.priority !== b.priority) {
                    return a.priority - b.priority;
                }
                // 같은 priority면 href가 긴 것 우선
                return b.href.length - a.href.length;
            });
            matches[0].item.classList.add('active');
        }
    });
    </script>
</body>
</html>
