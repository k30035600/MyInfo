# 은행거래 전처리후(after) 키워드/카테고리/기타거래가 비어 있을 때

## 합의한 흐름

1. **전처리전(before)**  
   `.source/Bank` 원본 → **전처리** (적요·내용·송금메모·거래점 치환) → `bank_before.xlsx` 저장.  
   (후처리·계정과목은 적용하지 않음.)

2. **전처리후(after)**  
   `bank_before.xlsx` 읽기 → **계정과목 분류** (before_text 기준) → **후처리** (적요·내용·송금메모 치환) → **기타거래** (before_text 기반) → `bank_after.xlsx` 저장.

즉, **before에서 전처리만 끝내고**, **after를 만들 때 계정과목 분류·후처리·기타거래**가 한 번에 적용됩니다.

---

## 키워드/카테고리/기타거래가 “비었다”는 것의 의미

전처리후(after) 파일/화면에서 이 세 컬럼이 **모두 비어 있다**면, 아래 중 하나입니다.

1. **전처리후 다시 실행을 하지 않았다**  
   - after는 **「전처리후 다시 실행」** 버튼을 눌렀을 때만 `classify_and_save()`로 **다시 생성**됩니다.  
   - 이 버튼을 누르지 않으면, 예전에 만들어진 `bank_after.xlsx`를 그대로 보게 되고, 그 파일에 키워드/카테고리/기타거래가 없거나 비어 있을 수 있습니다.

2. **전처리후 다시 실행이 실패했다**  
   - 실행 중 오류가 나면 after 파일이 갱신되지 않습니다.  
   - 화면에 표시되는 오류 메시지나, `LAST_CLASSIFY_ERROR` 등으로 원인을 확인할 수 있습니다.

3. **과거에 생성된 after 파일을 보고 있다**  
   - 키워드/카테고리/기타거래를 채우는 로직이 들어가기 전에 만들어진 `bank_after.xlsx`이면, 해당 컬럼이 없거나 비어 있을 수 있습니다.

정리하면, **“비었다” = after가 위 흐름(계정과목·후처리·기타거래 적용)으로 최근에 다시 만들어진 적이 없다**는 뜻입니다.

---

## 해결 방법

1. **전처리전(before) 확보**  
   - `bank_before.xlsx`가 없으면 먼저 **「통합·전처리 다시 실행」**을 실행해 주세요.

2. **전처리후(after) 다시 생성**  
   - 상단 **「전처리후 다시 실행」** 버튼을 눌러 주세요.  
   - 이때 `bank_before`를 읽고, 계정과목 분류·후처리·기타거래를 적용한 뒤 `bank_after.xlsx`를 덮어씁니다.

3. **계정과목 규칙 확인**  
   - `category_table.json`에 **분류=계정과목**인 행이 있어야, 키워드/카테고리가 “기타거래” 외 값으로 채워집니다.  
   - 규칙이 없으면 카테고리는 모두 “기타거래”, 키워드는 빈 칸으로 남을 수 있습니다.

---

## 코드상 흐름 참고

- **통합·전처리 다시 실행**: `integrate_bank_transactions()` → `bank_before.xlsx`만 생성.  
- **전처리후 다시 실행**: `classify_and_save()` → `bank_before` 읽기 → before_text·기타거래·계정과목·후처리 적용 → `bank_after.xlsx` 저장.

화면에 “전처리후 다시 실행을 실행하면 키워드/카테고리/기타거래가 채워집니다” 안내가 나오면, 위 2번을 실행하면 됩니다.
