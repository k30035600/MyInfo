<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>은행거래 도움말 - MyInfo</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Malgun Gothic', '맑은 고딕', sans-serif; background-color: #f5f5f5; padding: 20px; }
        .container { max-width: 1920px; margin: 0 auto; background: white; border-radius: 10px; padding: 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #333; margin-bottom: 30px; font-size: 2em; }
        h2 { color: #667eea; margin-top: 30px; margin-bottom: 15px; font-size: 1.5em; border-bottom: 2px solid #667eea; padding-bottom: 10px; }
        h3, h4 { color: #555; margin-top: 20px; margin-bottom: 10px; font-size: 1.2em; }
        .help-section { margin-bottom: 30px; }
        .help-section p, .help-section li { line-height: 1.8; color: #666; margin-bottom: 8px; }
        .help-section ul, .help-section ol { margin-left: 20px; margin-bottom: 15px; }
        .code-block { background: #f8f9fa; border-left: 4px solid #667eea; padding: 15px; margin: 15px 0; border-radius: 4px; font-family: monospace; overflow-x: auto; }
        .main-nav { display: flex; flex-wrap: wrap; gap: 5px; padding: 10px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; margin-bottom: 20px; }
        .nav-item { padding: 10px 15px; background: rgba(255,255,255,0.9); color: #333; text-decoration: none; border-radius: 5px; font-weight: bold; font-size: 14px; transition: all 0.3s ease; flex: 1; min-width: 120px; text-align: center; white-space: nowrap; }
        .nav-item:hover { background: #fff; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        .nav-item.active { background: #FF9800; color: white; }
        .toc { background: #f0f4ff; padding: 20px; border-radius: 8px; margin-bottom: 25px; }
        .toc ul { list-style: none; margin-left: 0; }
        .toc a { color: #667eea; text-decoration: none; }
        table.help-table { border-collapse: collapse; width: 100%; margin: 15px 0; font-size: 14px; }
        table.help-table th, table.help-table td { border: 1px solid #ddd; padding: 8px 12px; text-align: left; }
        table.help-table th { background: #f0f4ff; color: #333; }
        @media (max-width: 768px) { .container { padding: 20px; } .nav-item { font-size: 11px; min-width: 80px; } }
    </style>
</head>
<body>
    <nav class="main-nav" aria-label="은행거래 메뉴">
        <a href="/" class="nav-item">🏠 홈</a>
        <a href="/bank/" class="nav-item">🏦 전처리</a>
        <a href="/bank/category" class="nav-item">🏷️ 카테고리</a>
        <a href="/bank/analysis/basic" class="nav-item">📊 기본분석</a>
        <a href="/bank/help" class="nav-item active">❓ 도움말</a>
    </nav>
    <div class="container">
        <h1>❓ 은행거래 도움말</h1>
        <p>은행거래 통합정보(MyBank)는 <strong>국민은행, 신한은행, 하나은행</strong> 등 거래 내역을 전처리·카테고리 분류·기본분석으로 관리합니다. 카테고리는 <strong>전처리 → 계정과목 분류 → 후처리</strong> 순으로 적용됩니다.</p>

        <div class="help-section toc">
            <h2>목차</h2>
            <ul>
                <li><a href="#category-detail">1. 카테고리 분류 상세(은행)</a></li>
                <li><a href="#flow">2. 사용 흐름</a></li>
                <li><a href="#pages">3. 메뉴별 안내</a></li>
                <li><a href="#trouble">4. 문제 해결</a></li>
                <li><a href="#urls">5. 접속 주소</a></li>
            </ul>
        </div>

        <div class="help-section" id="category-detail">
            <h2>1. 카테고리 분류 상세(은행)</h2>
            <p>은행 거래의 카테고리는 <strong>category_table.json</strong>(<code>MyInfo/.source/category_table.json</code>) 한 파일로 관리하며, <strong>분류</strong> 컬럼 값에 따라 적용 시점과 대상이 다릅니다. 거래방법·거래지점 분류는 사용하지 않습니다.</p>

            <h3>1.1 적용 순서 요약</h3>
            <ol>
                <li><strong>전처리</strong>: 원본 엑셀을 읽은 직후, <strong>적요·내용·송금메모·거래점</strong> 네 컬럼에만 키워드→치환 규칙 적용. 적용 후 <strong>bank_before.xlsx</strong> 저장.</li>
                <li><strong>계정과목</strong>: bank_before를 읽은 뒤 <strong>before_text</strong>만 사용해 키워드 매칭 → <strong>키워드·카테고리</strong> 컬럼 채움. (before_text는 취소 + 적요·내용·송금메모·거래점을 #로 연결한 문자열)</li>
                <li><strong>후처리</strong>: 계정과목 적용이 끝난 뒤, 저장 직전에 <strong>적요·내용·송금메모</strong> 세 컬럼에만 키워드→치환 규칙 적용. 적용 후 <strong>bank_after.xlsx</strong> 저장.</li>
            </ol>

            <h3>1.2 전처리 (분류 = 전처리)</h3>
            <ul>
                <li><strong>목적</strong>: 원본 텍스트를 통일·정리해 이후 계정과목 매칭 정확도를 높입니다. 예: "초록마을" → "초록증권", 오타·동의어 통합.</li>
                <li><strong>대상 컬럼</strong>: <strong>적요</strong>, <strong>내용</strong>, <strong>송금메모</strong>, <strong>거래점</strong> (은행 거래 표준 컬럼).</li>
                <li><strong>규칙</strong>: category_table에서 <code>분류 = 전처리</code>인 행만 사용. <strong>키워드</strong>에 있는 문자열(공백 무시 매칭)을 <strong>카테고리</strong> 값으로 치환. 긴 키워드부터 적용합니다.</li>
                <li><strong>시점</strong>: .source/Bank 엑셀을 읽어 통합한 직후, bank_before.xlsx로 저장하기 전에 한 번만 수행됩니다. 후처리·계정과목은 이 단계에서 적용하지 않습니다.</li>
            </ul>

            <h3>1.3 계정과목 (분류 = 계정과목)</h3>
            <ul>
                <li><strong>목적</strong>: 거래 내용을 지출/수입 항목(외식, 의료비, 교통비, 이체 등)으로 분류합니다. 기본분석·금융정보 병합 시 카테고리별 집계에 사용됩니다.</li>
                <li><strong>검색 대상</strong>: <strong>before_text</strong> 한 컬럼만 사용합니다. before_text = 취소 + 적요 + 내용 + 송금메모 + 거래점을 <code>#</code>로 이어 붙인 문자열(전처리 반영 후). 거래점은 포함, 기타거래 컬럼은 사용하지 않습니다.</li>
                <li><strong>규칙</strong>: category_table에서 <code>분류 = 계정과목</code>인 행만 사용. <strong>키워드</strong>에 여러 키워드를 <code>/</code>로 OR 조건 지정 가능(예: <code>파리바게뜨/베이커리</code>). 키워드가 before_text에 <strong>포함</strong>되면 해당 행의 <strong>카테고리</strong> 값을 부여합니다.</li>
                <li><strong>우선순위</strong>: 같은 행에 여러 규칙이 매칭되면 <strong>매칭된 키워드 길이가 긴 것</strong>이 이깁니다. 먼저 전체를 "기타거래"로 채운 뒤, 규칙을 긴 키워드 순으로 적용해 덮어씁니다.</li>
                <li><strong>저장</strong>: 매칭된 행의 <strong>키워드</strong> 컬럼에는 실제로 매칭된 키워드(가장 긴 것), <strong>카테고리</strong> 컬럼에는 해당 계정과목 값이 저장됩니다. 매칭되지 않은 행은 "기타거래"로 남습니다.</li>
            </ul>

            <h3>1.4 후처리 (분류 = 후처리)</h3>
            <ul>
                <li><strong>목적</strong>: 계정과목 분류가 끝난 뒤, 표시용·보고용으로 적요/내용/송금메모 문구를 한 번 더 치환합니다. 예: 상호 정리, 개인정보 마스킹 대체 표현.</li>
                <li><strong>대상 컬럼</strong>: <strong>적요</strong>, <strong>내용</strong>, <strong>송금메모</strong> (거래점은 후처리 대상에 포함되지 않음).</li>
                <li><strong>규칙</strong>: category_table에서 <code>분류 = 후처리</code>인 행만 사용. 키워드 → 카테고리 치환 방식은 전처리와 동일하며, 긴 키워드부터 적용합니다.</li>
                <li><strong>시점</strong>: 계정과목 적용 후, bank_after.xlsx로 저장하기 직전에 수행됩니다.</li>
            </ul>

            <h3>1.5 분류별 요약표</h3>
            <table class="help-table">
                <thead>
                    <tr><th>분류</th><th>대상 컬럼</th><th>시점</th><th>용도</th></tr>
                </thead>
                <tbody>
                    <tr><td>전처리</td><td>적요, 내용, 송금메모, 거래점</td><td>before 저장 전</td><td>원본 텍스트 통일·정리</td></tr>
                    <tr><td>계정과목</td><td>before_text(취소+적요+내용+송금메모+거래점)</td><td>after 생성 시</td><td>키워드 매칭으로 카테고리·키워드 부여</td></tr>
                    <tr><td>후처리</td><td>적요, 내용, 송금메모</td><td>after 저장 직전</td><td>표시용 문구 치환</td></tr>
                </tbody>
            </table>
            <p><strong>참고</strong>: "카테고리 생성"은 bank_before 기준으로 category_table에 전처리·후처리·계정과목 규칙을 자동 생성·보강합니다. "카테고리 적용"을 실행하면 위 순서대로 전처리(이미 before에 반영됨) → 계정과목 → 후처리가 적용된 bank_after가 생성·갱신됩니다.</p>
        </div>

        <div class="help-section" id="flow">
            <h2>2. 사용 흐름</h2>
            <ol>
                <li><strong>.source/Bank</strong>에 은행별 거래 내역 .xls/.xlsx를 넣습니다. 파일명에 국민은행, 신한은행, 하나은행이 포함되어야 인식됩니다.</li>
                <li><strong>은행거래 전처리(/bank/)</strong>에서 "전처리 실행"을 클릭하면 전처리 규칙이 적용된 <strong>bank_before.xlsx</strong>가 .source 또는 MyBank에 생성·갱신됩니다.</li>
                <li><strong>은행거래 카테고리(/bank/category)</strong>에서 "카테고리 생성"으로 규칙을 만든 뒤 필요 시 분류·키워드·카테고리를 수정하고, "카테고리 적용"으로 <strong>bank_after.xlsx</strong>를 생성·갱신합니다.</li>
                <li><strong>은행거래 기본분석(/bank/analysis/basic)</strong>에서 bank_after 기준 통계·차트를 확인합니다.</li>
            </ol>
        </div>

        <div class="help-section" id="pages">
            <h2>3. 메뉴별 안내</h2>
            <h3>은행거래 전처리 (/bank/)</h3>
            <p>.source/Bank의 엑셀을 읽어 통합하고, 전처리 규칙을 적용한 뒤 bank_before.xlsx를 저장합니다. 전처리 전·후 테이블을 비교할 수 있으며, 은행·년·월 필터를 사용할 수 있습니다.</p>
            <h3>은행거래 카테고리 (/bank/category)</h3>
            <p>카테고리 테이블(분류, 키워드, 카테고리)을 편집하고, "카테고리 적용"으로 bank_after를 만듭니다. 적용 후 테이블에서 결과를 확인할 수 있습니다.</p>
            <h3>은행거래 기본분석 (/bank/analysis/basic)</h3>
            <p>bank_after.xlsx 기준 전체 통계, 적요별·월별·은행/계좌별 집계와 차트를 제공합니다.</p>
        </div>

        <div class="help-section" id="trouble">
            <h2>4. 문제 해결</h2>
            <p><strong>데이터가 없음</strong>: .source/Bank에 .xls/.xlsx가 있고 파일명에 은행명이 포함되는지 확인하세요. Excel에서 파일을 닫은 뒤 전처리를 다시 실행하세요.</p>
            <p><strong>카테고리가 적용되지 않음</strong>: .source/category_table.json이 있는지, "카테고리 생성" 후 "카테고리 적용" 순서로 실행했는지 확인하세요. bank_after를 다른 프로그램에서 열어두지 마세요.</p>
            <p><strong>통합 도움말</strong>: <a href="/help">/help</a>에서 은행·신용카드·금융정보 전체 안내를 볼 수 있습니다.</p>
        </div>

        <div class="help-section" id="urls">
            <h2>5. 접속 주소</h2>
            <ul>
                <li><strong>은행거래 전처리:</strong> http://localhost:8080/bank/</li>
                <li><strong>은행거래 카테고리:</strong> http://localhost:8080/bank/category</li>
                <li><strong>은행거래 기본분석:</strong> http://localhost:8080/bank/analysis/basic</li>
                <li><strong>은행거래 도움말:</strong> http://localhost:8080/bank/help</li>
            </ul>
        </div>
    </div>
</body>
</html>
