# 로딩·시간 감축 제안서

## 1. 적용 요약

| 항목 | 내용 | 상태 |
|------|------|------|
| 데이터 포맷 | bank/card/cash before·after를 xlsx → **JSON**으로 변경 | 제안 후 구현 |
| 백업 파일 | **.bak 파일 생성하지 않음** | 제안 후 구현 |
| 테이블 출력 | JSON 테이블 출력 시 **30건 단위 페이지네이션** (대기 시간 감축) | 제안 후 구현 |
| 기타 로딩 개선 | 아래 2~4번 제안 | 검토 후 승인 시 반영 |

---

## 2. 데이터 포맷: xlsx → JSON

- **대상 파일**
  - MyBank: `bank_before.xlsx` → `bank_before.json`, `bank_after.xlsx` → `bank_after.json`
  - MyCard: `card_before.xlsx` → `card_before.json`, `card_after.xlsx` → `card_after.json`
  - MyCash: `cash_after.xlsx` → `cash_after.json` (cash_before는 bank+card 병합 결과이므로 동일 포맷으로 저장 시 JSON)
- **흐름 유지**
  - source(.xls/.xlsx) 읽기 → 전처리 → **before JSON** 생성 → 카테고리 분류 → 후처리 → **after JSON** 생성
- **효과**
  - Excel 의존 제거, 파싱 속도·호환성 개선, 버전 관리·디버깅 용이

---

## 3. .bak 파일 미생성

- **현재**: 손상/복구 시나리오에서 `*.xlsx.bak`, `category_table.json.bak` 등 생성
- **변경**: 백업 파일을 만들지 않고, 필요 시 해당 파일만 삭제 후 재생성 또는 빈 DataFrame/빈 JSON 반환
- **효과**: 디스크 사용·파일 수 감소, 사용자 혼란 감소

---

## 4. 테이블 API: 30건 단위 페이지네이션

- **대상 API**
  - `/api/processed-data`, `/api/category-applied-data` (MyBank)
  - `/api/processed-data`, `/api/category-applied-data` (MyCard)
  - `/api/category-applied-data` (MyCash)
  - (선택) `/api/source-data` 등 대용량 배열 반환 API
- **방식**
  - 쿼리: `limit`(기본 30), `offset`(기본 0)
  - 응답: `total`, `limit`, `offset`, `data`(현재 페이지 구간만)
- **효과**
  - 첫 화면 로딩 시 30건만 전송해 응답 시간·메모리 감소, “로딩 중…” 표시 시간 단축

---

## 5. 기타 “로딩 중…”·시간 감축 제안

1. **API 타임아웃**
   - 프론트에서 fetch 타임아웃을 60초 등으로 제한해 무한 로딩 방지 (이미 MyCard 등 일부 적용 가능성 있음). 모든 앱에서 동일 적용 권장.

2. **캐시·조건부 요청**
   - 테이블 데이터에 `Last-Modified` / `ETag` 또는 짧은 캐시(예: 5초)를 두어, “다시 불러오기” 전까지 동일 데이터 재요청 시 304 또는 로컬 캐시 사용으로 응답 시간 감소.

3. **점진적 렌더링**
   - 첫 30건 수신 즉시 테이블에 그리기 시작하고, “더 보기” 또는 페이지 번호로 다음 30건 요청. 사용자는 빈 화면 대기 시간이 줄어듦.

4. **카테고리 생성/병합 비동기**
   - “카테고리 생성”·“cash_after 병합” 등 무거운 작업을 백그라운드 작업으로 돌리고, 진행률 또는 “완료 시 알림”으로 화면에 표시. (구현 규모 큼, 2차 검토 권장)

5. **원본(source) 목록만 먼저 로드**
   - 전처리 화면에서 “원본 파일 목록”만 먼저 요청해 빠르게 표시하고, “전처리후” 등 테이블은 사용자가 탭 선택 시에만 `limit=30&offset=0`으로 요청.

---

## 6. 승인 및 구현 순서

- **즉시 적용(승인 가정)**
  - 2. xlsx → JSON 전환
  - 3. .bak 미생성
  - 4. 테이블 API 30건 페이지네이션 + 프론트 30건 요청·페이징 UI
- **추가 승인 후**
  - 5번 항목 중 타임아웃·캐시·점진적 렌더링 등은 별도 승인 후 코드 반영 제안.

이 제안서 승인 후 2·3·4번부터 코드 수정 진행합니다.
