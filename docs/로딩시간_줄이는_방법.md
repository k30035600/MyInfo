# 로딩 시간 줄이는 방법

금융정보·은행·신용카드 페이지에서 체감 로딩을 줄이기 위한 방법을 정리했습니다.

---

## 1. 이미 적용된 것

- **캐시**: `cash_after`, `bank_after`, `card_after` 등은 파일 로드 후 메모리 캐시(`_cash_after_cache` 등)로 재사용됩니다. 같은 세션에서 재조회 시 파일을 다시 읽지 않습니다.
- **gzip 응답**: `app.py`에서 JSON/텍스트 응답이 1KB 이상이면 gzip 압축해 전송합니다. 전송량이 줄어 로딩이 빨라집니다.
- **limit + 나머지 1회**: 첫 요청은 limit=1000, total>1000일 때만 offset=1000으로 한 번 더 요청해, 요청 횟수를 최소화했습니다.

---

## 2. 서버(백엔드)에서 할 수 있는 것

| 방법 | 설명 |
|------|------|
| **캐시 무효화 최소화** | cash_after 재생성 시에만 캐시를 비우고 있습니다. 다른 API에서 불필요하게 캐시를 지우지 않도록 유지하세요. |
| **필터·정렬 후 슬라이스** | `/api/category-applied-data` 등은 이미 전체 필터/정렬 후 `limit`/`offset`으로 슬라이스합니다. 정렬은 전체에 한 번만 하면 됩니다. |
| **필요 컬럼만 반환** | API에 `columns=금융사,계좌번호,거래일,...` 같은 파라미터를 두고, 화면에 쓰는 컬럼만 JSON에 넣으면 용량·직렬화 비용이 줄어듭니다. (구현 시 기존 호출과 호환되게 기본값은 전체 컬럼) |
| **JSON 직렬화** | 대량 데이터일 때 `jsonify` 대신 `orjson` 등 빠른 직렬화를 쓰면 서버 CPU 시간이 줄어듭니다. (Flask에서 orjson 프로바이더 사용 가능) |
| **디스크 I/O** | cash_after.json, bank_after.json 등이 큰 경우 SSD 사용, 한글 없는 경로 사용으로 I/O 지연을 줄이면 도움이 됩니다. |

---

## 3. 프론트엔드에서 할 수 있는 것

| 방법 | 설명 |
|------|------|
| **병렬 요청** | 페이지 로드 시 `loadRightData()`와 `loadCategoryQueryTable()` 등 서로 독립된 API는 `Promise.all([loadRightData(), loadCategoryQueryTable()])`처럼 동시에 호출하면, 순차 호출보다 전체 대기 시간이 줄어듭니다. (동일 도메인이면 브라우저가 병렬로 처리) |
| **첫 화면 우선** | 테이블을 먼저 그린 뒤, 차트(월별 추이 등)는 `requestAnimationFrame` 또는 `setTimeout(..., 0)`으로 다음 프레임에 요청해, “먼저 보이는 것”을 빨리 표시할 수 있습니다. |
| **중복 호출 제거** | 같은 탭/같은 화면에서 필터만 바꿀 때 전체 데이터를 다시 받지 않고, 이미 받은 데이터로 필터링만 하면 요청 수가 줄어듭니다. (이미 일부 화면에서는 적용됨) |
| **로딩 표시** | “데이터 로딩 중…” 등 로딩 UI를 명확히 하면 체감 대기 시간이 줄어든 것처럼 느껴집니다. |

---

## 4. 데이터·운영 측면

| 방법 | 설명 |
|------|------|
| **데이터 크기** | 필요한 기간만 전처리(bank_after, card_after)에 포함하면 건수와 파일 크기가 줄어 로딩이 빨라집니다. |
| **금융정보 진입 시 삭제** | 현재는 금융정보 메뉴 진입 시 cash_after를 삭제하지 않도록 되어 있을 수 있습니다. 삭제 정책을 완화하면 재진입 시 재생성 대기 시간이 사라집니다. (도움말에 “진입 시 삭제”가 있다면 코드와 정책을 맞추어 확인) |
| **전처리후 다시 실행** | cash_after가 없을 때 자동 생성 대신, 사용자가 **전처리후 다시 실행** 버튼을 한 번 눌러 생성해 두면, 이후 조회는 캐시된 파일만 읽어 빨라집니다. |

---

## 5. 요약

- **이미**: 캐시, gzip, limit 1000 + 나머지 1회 요청으로 로딩이 어느 정도 최적화되어 있음.
- **추가로**: API는 “필요 컬럼만”, 프론트는 “병렬 요청 + 첫 화면 우선 표시”, 데이터는 “필요 기간만” 적용하면 체감 로딩 시간을 더 줄일 수 있습니다.

구체적으로 어떤 페이지(금융정보 전처리, 카테고리, 기본분석 등)가 가장 느린지 정하면, 그 구간에 맞춰 위 방법을 우선 적용할 수 있습니다.
