# 금융정보 전처리 페이지 — 금융정보(카테고리) 조회 처리 내용

금융정보(`/cash`) 전처리 페이지에는 **업종분류 조회**와 **금융정보(카테고리) 조회**가 둘 다 있습니다.  
(문서·코드에서 "카테고리 조회"라고 할 때 금융정보 페이지에서는 **"금융정보(카테고리) 조회"**를 가리킵니다.)  
아래는 **금융정보(카테고리) 조회** 쪽만의 처리 내용입니다.

---

## 1. UI 위치·이름

- **화면 표기**: "금융정보(카테고리) 조회" (우측 75% 영역, 업종분류 조회 오른쪽)
- **컨테이너**: `#category-query-content`
- **버튼**: "전처리후 다시 실행" (`generate-category-btn`) → after 파일 재생성

---

## 2. 생성 요청 시간 초과 시 처리

- cash_after가 없을 때 자동으로 `POST /cash/api/generate-category` 호출(최대 60초 대기).
- **생성 요청 시간이 초과**되면:
  - 메시지: "생성 요청 시간이 초과되었습니다." (빨간색 표시)
  - 안내: "새로고침(F5) 후 위 '전처리후 다시 실행' 버튼으로 재시도하세요."
  - **다시 시도** 버튼으로 `loadCategoryQueryTable()` 재호출 가능.

---

## 3. 데이터 소스·API

| 항목 | 내용 |
|------|------|
| API | `GET /cash/api/category-applied-data` |
| 쿼리 | `bank`, `account`, `date`(YY/MM→YYYY-MM), `limit`, `offset` |
| 데이터 | **cash_after** (은행 bank_after + 신용카드 card_after 병합 후 카테고리 적용된 거래 목록) |
| 페이지네이션 | 첫 요청 `limit=1000`, `offset=0` → `total > 1000`이면 `offset=1000`으로 나머지 요청 후 `data.data`에 이어붙임 |

---

## 4. 테이블 렌더링

- **함수**: `renderCategoryQueryTable(data, options)`
- **저장 변수**: `categoryQueryTableData = data` (필터·그래프용. 이 테이블에는 행 클릭 말풍선 없음)
- **컬럼 순서**:  
  `금융사`, `계좌번호`, `거래일`, `거래시간`, `입금액`, `출금액`, `취소`, `기타거래`, `키워드`, `카테고리`, `사업자번호`  
  (실제 표시는 데이터에 있는 컬럼만)
- **행**: `<tr data-i="${rowIndex}" class="category-query-row">` (말풍선 미사용)
- **헤더 2행**: 1행=컬럼명, 2행=컬럼별 필터 드롭다운 (`filter-category-query-{col}`)
- **필터 특수 옵션**: 카테고리 컬럼에 "미분류", 거래시간에 "심야구분"

---

## 5. 말풍선(행 클릭)

- **금융정보(카테고리) 조회에는 말풍선을 사용하지 않습니다.** (은행/신용카드 전처리 페이지의 "카테고리 조회"와 달리 행 클릭 시 툴팁 없음.)
- 말풍선은 같은 페이지의 **업종분류 조회** 테이블에만 사용됩니다.

---

## 6. 필터·그래프

- **필터**: `filterCategoryQueryTable()` — 컬럼별 드롭다운 값으로 테이블 행 필터링, 필터 결과로 `categoryQueryDataOriginal` 기반 재구성
- **그래프**: "금융정보(카테고리) 그래프" (`#category-combined-chart`) — 카테고리 조회 테이블(필터 적용) 데이터로 업데이트

---

## 7. 업종분류 조회와의 차이 (같은 페이지 내)

| 구분 | 카테고리 조회 | 업종분류 조회 |
|------|----------------|----------------|
| 제목 | 금융정보(카테고리) 조회 | 업종분류 조회 |
| 데이터 | cash_after (거래 건별) | linkage_table.json (업종 목록) |
| API | `/cash/api/category-applied-data` | linkage_table.json 파일 로드 |
| DOM | `#category-query-content`, `.category-query-row`, `data-i` | `#linkage-query-content`, `.linkage-query-row`, `data-tx-index` |
| 변수 | `categoryQueryTableData` | `linkageTableData` |
| 말풍선 내용 | 거래 1건 전체 컬럼 | 업종 1건 전체 컬럼 |

말풍선 **UI·열 순서(JSON 컬럼순)·닫기** 동작은 동일하고, **데이터만** 카테고리 조회는 거래, 업종분류 조회는 업종입니다.
