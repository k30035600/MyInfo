# 금융정보(Cash) 위험도 분류·저장 방법

## 저장 구조 (cash_after.json)

- **위험도키워드**: 매칭된 키워드 또는 조건 표시 (1·2호: 2호는 출금만존재·100만원 이상·3회 이상 시 해당 키워드 저장 / 3~8호: 증권, 대부, 업비트 등 실제 매칭 키워드). **위험도분류**와 달리 지표명(비정형지표 등)을 넣지 않음.
- **위험도분류**: 1~8호 지표명 (자료소명지표, 비정형지표, 투기성지표, 사기파산지표, 가상자산지표, 자산은닉지표, 과소비지표, 사행성지표)
- **위험도**: 숫자 0.1 ~ 5.0 (최소 0.1, 높을수록 위험)

구 컬럼명(업종코드, 업종분류)은 로드 시 위험도키워드·위험도분류로 자동 변환됩니다.

---

## 분류·저장 흐름

1. **cash_after 생성**  
   은행거래(bank_after) + 신용카드(card_after) 병합 시, 각 행에 `위험도키워드`, `위험도분류`, `위험도` 컬럼이 비어 있는 상태로 생성됩니다.

2. **linkage_table 매칭**  
   `_apply_업종분류_from_linkage()`:  
   - `.source/linkage_table.json`의 업종코드(키)로 **위험도키워드**를 매칭  
   - 매칭된 행에 **위험도분류**, **위험도**(리스크 값) 저장

3. **1~8호 위험도 지표 적용**  
   `risk_indicators.apply_risk_indicators()`:  
   - 모든 행 **위험도**를 0.1로 초기화  
   - **1차분류**: **키워드 → 거래일** 올림차순 정렬 후 **1호·2호** 적용(출금액 기준). 해당 행은 2차분류에서 skip  
   - **2차분류**: **카테고리 → 키워드 → 거래일** 올림차순 정렬 후 **3호~8호** 적용((카테고리+키워드+기타거래) 텍스트 매칭). 1차분류 해당 행은 적용하지 않음

4. **고위험 카테고리 보정**  
   `_apply_risk_category_by_keywords()`:  
   - 카테고리/키워드/기타거래에서 가상자산·증권투자·금전대부 매칭 시 **위험도분류**, **위험도 5.0** 설정

5. **저장**  
   최종 DataFrame을 `MyCash/cash_after.json`에 저장합니다.  
   키 이름: `위험도키워드`, `위험도분류`, `위험도` (과거 업종코드/업종분류는 사용하지 않음).

---

## 1~8호 지표 요약 (저장되는 위험도분류·위험도)

| 호수 | 위험도분류   | 위험도 | 조건 요약 |
|------|--------------|--------|-----------|
| 1호  | 자료소명지표 | 1.0    | 출금 500만원 이상 (해당 행 키워드 → 위험도키워드) |
| 2호  | 비정형지표   | 1.5    | 특정인=키워드 기준, 출금만 100만원 이상 3회 이상 (해당 키워드 → 위험도키워드) |
| 3호  | 투기성지표   | 2.0    | 입출금 50만원 이상 + 증권/선물/자산운용 등 키워드 |
| 4호  | 사기파산지표 | 2.5    | 입출금 50만원 이상 + 대부/P2P 키워드 |
| 5호  | 가상자산지표 | 3.0    | 입출금 50만원 이상 + 카테고리 가상자산 또는 코인/거래소 키워드 |
| 6호  | 자산은닉지표 | 3.5    | 출금만 50만원 이상 + 해외송금/Wise 등 키워드 |
| 7호  | 과소비지표   | 4.0    | 출금만 30만원 이상 + 백화점/명품/유흥 등 키워드 |
| 8호  | 사행성지표   | 5.0    | 출금만 10만원 이상 + 경마/복권/도박/휴게텔 등 키워드 |

상세 규칙은 `MyCash/risk_indicators.py`의 `apply_risk_indicators()`와 `get_risk_indicators_document()`를 참고하세요.

---

## 1호·2호와 위험도키워드(키워드 저장)

- **1호 (자료소명지표)**: 출금 **500만원 이상**인 행. 해당 행의 **키워드**(또는 기타거래) 값을 **위험도키워드**에 저장.
- **2호 (비정형지표)**: **특정인 = 키워드 기준**. 같은 키워드로 묶어서, **출금만 100만원 이상**인 거래가 **3회 이상**이면 해당 키워드의 그 행들에 2호 부여. **위험도키워드**에는 그 **키워드** 값을 저장.
- 예전에 생성된 cash_after에는 1·2호 행에 위험도키워드가 조건문자열 또는 지표명으로 저장된 경우가 있습니다. **cash_after를 다시 생성(병합)** 하면 위험도키워드에 키워드 값이 반영됩니다.
