# 금융정보 위험도 지표 매칭 가이드 (Risk Index Matching)

이 문서는 금융정보 데이터(cash_after)의 위험도를 산출하고, cash_after의 **키워드**, **기타거래**, **입금액**, **출금액**을 기반으로 1호부터 8호까지의 지표를 순차적으로 매칭하여 시스템에 반영하는 절차를 정의합니다.

---

## 1. 기본 처리 원칙

- **초기화**: 모든 행의 기본 위험도는 **0.1**로 설정됩니다.
- **1차분류·2차분류**: 위험도 적용을 **1차분류**(1호·2호)와 **2차분류**(3호~8호)로 나눕니다. 1차분류에 해당하는 행은 2차분류에서 제외됩니다.
- **데이터 업데이트**: 매칭된 결과는 cash_after 테이블의 **위험도키워드**, **위험도분류**, **위험도** 컬럼에 저장됩니다.

### 1차분류 (1호·2호)

- **정렬**: cash_after를 **키워드 → 거래일** 올림차순으로 정렬한 뒤 적용합니다.
- **적용 기준**: **출금액** 조건으로만 위험도 적용(1호: 출금 500만원 이상, 2호: 출금만 100만원 이상·동일 키워드 3회 이상).
- 1호 또는 2호에 해당하는 행은 **2차분류(3호~8호)를 적용하지 않습니다.**

### 2차분류 (3호~8호)

- **정렬**: cash_after를 **카테고리 → 키워드 → 거래일** 올림차순으로 정렬한 뒤 적용합니다.
- **적용 기준**: **(카테고리+키워드+기타거래)** 결합 텍스트를 대상으로 키워드 매칭 후 위험도 적용.
- 1차분류(1호·2호)에 해당한 행은 이 단계에서 skip됩니다.

---

## 2. 위험도 지표 상세 기준표

| 지표 | 명칭 | 위험도 | 매칭 조건 (금액/횟수) | 대상 키워드 (기타거래·키워드 컬럼 비교) |
|------|------|--------|------------------------|----------------------------------------|
| 1호 | 자료소명지표 | 1.0 | 출금 500만 원 이상 | 해당 행 **키워드** → 위험도키워드 저장 |
| 2호 | 비정형지표 | 1.5 | 특정인=**키워드** 기준, 출금만 100만 원 이상 **3회 이상** | 해당 **키워드** → 위험도키워드 저장 |
| 3호 | 투기성지표 | 2.0 | **출금만** 50만 원 이상 | 증권, 선물, 자산운용, 위탁, 증권입금 |
| 4호 | 사기파산지표 | 2.5 | **출금만** 50만 원 이상 | 대부, P2P, 카드깡, 원리금 |
| 5호 | 가상자산지표 | 3.0 | **출금만** 50만 원 이상 | 가상자산 분류, 업비트, 빗썸, 코인원, 코빗 등 |
| 6호 | 자산은닉지표 | 3.5 | 출금만 존재, 50만 원 이상 | 해외송금, 고액현금인출, 외화송금, Wise, 영문성명 |
| 7호 | 과소비지표 | 4.0 | 출금만 존재, 30만 원 이상 | 백화점, 명품, 귀금속, 유흥, 고가가전, 고가가구 |
| 8호 | 사행성지표 | 5.0 | 출금만 존재, 10만 원 이상 | 경마, 복권, 도박, 사행성게임기, 안마, 마사지 등 |

---

## 3. 지표별 상세 키워드 및 분류 가이드

### [1호·2호] 자료소명·비정형 (키워드를 위험도키워드로 저장)

- **1호 (자료소명지표)**: 출금 **500만원 이상**인 행 1건만 있어도 해당 행의 **키워드**(또는 기타거래) 값을 **위험도키워드**에 저장.
- **2호 (비정형지표)**: **특정인 = 키워드**. 같은 키워드(동일인)로 묶어, **출금만 100만원 이상**인 거래가 **3회 이상**이면 그 키워드의 해당 행들에 2호 부여. **위험도키워드**에는 그 **키워드** 값을 저장.

### [3호~5호] 투자 및 투기 관련 (출금만 조건)

- **3호 (투기성)**: **출금만 50만원 이상**. 증권/선물/자산운용/위탁 관련 거래 내역.
- **4호 (사기파산)**: **출금만 50만원 이상**. 동일 가맹점 카드깡, 대부업체 원리금 반복 상환. (키워드: 대부, P2P, 카드깡, 원리금)
- **5호 (가상자산)**: **출금만 50만원 이상**. "가상자산" 또는 VASP 거래소 명칭 매칭. category_table에서 분류 "가상자산", 키워드(업비트/빗썸/코인원/코빗 등) 매칭.

### [6호~8호] 자산 은닉 및 불건전 소비

- **6호 (자산은닉)**: SWIFT 코드(8~11자리), 해외 송금 플랫폼(Wise/TransferWise) 매칭.
- **7호 (과소비)**: 백화점/명품 외 업종코드 기반(유흥주점 56211, 무도장 91291 등) 또는 키워드 매칭.
- **8호 (사행성)**: 사설도박, 복권, 불건전 게임 S/W 개발(5821), 향락업소(휴게텔, 키스방, 안마 등).

---

## 4. 작업 확인 및 실행 절차 (Checklist)

백그라운드에서 위험도 지표가 올바르게 적용되는지 아래 순서대로 확인하십시오.

### [단계 1] 서버 구동 및 초기 데이터 생성

- [ ] 서버가 정상적으로 작동 중인지 확인합니다.
- [ ] 금융정보 통합작업 메뉴에서 **cash_after 생성(병합)**을 실행합니다.
- [ ] 모든 데이터의 초기 위험도가 **0.1**로 저장되었는지 확인합니다.

### [단계 2] 위험도 지표 백그라운드 적용

- [ ] 병합 시 자동으로 1호~8호 지표 매칭이 수행됩니다. (cash_app.merge_bank_card_to_cash_after → apply_risk_indicators)
- [ ] cash_after 테이블의 **기타거래**, **키워드** 컬럼과 대상 키워드가 정확히 대조되는지 모니터링합니다.

### [단계 3] 결과 검증 및 저장 확인

- [ ] 매칭된 행의 **위험도키워드**가 해당 지표의 키워드와 일치하는지 확인합니다.
- [ ] **위험도분류** 명칭이 정확히 기재되었는지 확인합니다.
- [ ] 최종 **위험도** 수치가 기준표(1.0 ~ 5.0)와 동일하게 수정되었는지 확인합니다.

---

## 구현 참고

- **적용 로직**: `MyCash/risk_indicators.py` — `apply_risk_indicators()`
- **저장**: `MyCash/cash_after.json` — 키: 위험도키워드, 위험도분류, 위험도
- **문서 요약**: `readme(삭제하지 말것)/금융정보_위험도_분류_저장.md`
