# 코드 개선안 (순차 적용, UI/UX 제외)

진입점(app.py) → 공통 모듈 → 서브앱 순으로 분석한 **비-UI/UX** 개선 항목입니다.  
승인 후 항목별로 순차 적용합니다.

---

## 1. app.py (진입점)

| # | 구분 | 내용 | 비고 |
|---|------|------|------|
| 1.1 | 유지보수 | `_read_app_file()` 서브프로세스 호출 시 인자 순서: 현재 `script`에서 `open(p, ...)`의 `p=sys.argv[1]`에 `base_name`(파일명만) 전달. 주석으로 "p=읽을 파일명, cwd=subapp_dir 이므로 subapp_dir/p 경로로 열림" 명시 | 가독성 |
| 1.2 | 상수 | 서브프로세스 타임아웃 `30` → 상수로 추출 (예: `_SUBAPP_READ_TIMEOUT = 30`) | 유지보수 |

---

## 2. data_json_io.py

| # | 구분 | 내용 | 비고 |
|---|------|------|------|
| 2.1 | 버그/정리 | `safe_write_data_json()` 끝의 `return False`는 **도달 불가**. 루프는 항상 `return True` 또는 `raise`로 종료됨. 제거하거나, 이론적 실패 시 `raise` 후 상위에서 처리하도록 명확히 함 | 정확성 |

---

## 3. category_table_io.py

| # | 구분 | 내용 | 비고 |
|---|------|------|------|
| 3.1 | 동작 유지 | 현재 `_lock`으로 동시 쓰기 직렬화·임시 파일·재시도 처리 적절. 변경 없음 | - |

---

## 4. shared_app_utils.py

| # | 구분 | 내용 | 비고 |
|---|------|------|------|
| 4.1 | 중복 제거 | 바이트 크기 → 사람이 읽기 좋은 문자열 변환(`_human`: 1024→KB, 1024²→MB)이 **MyBank/bank_app, MyCard/card_app, MyCash/cash_app**에 각각 존재. `shared_app_utils`에 `format_bytes(n)` 추가 후 세 앱에서 공통 사용 | 중복 제거 |

---

## 5. process_*_data (MyBank, MyCard, MyCash)

| # | 구분 | 내용 | 비고 |
|---|------|------|------|
| 5.1 | 중복 제거 | `safe_write_excel(df, filepath, max_retries=3)`가 **process_bank_data**, **process_card_data**, **process_cash_data**에 거의 동일하게 존재. 공통 모듈(예: `data_json_io` 또는 `shared_app_utils`)로 한 곳에 두고 import 하여 재사용 | 중복 제거, 유지보수 |
| 5.2 | 예외 처리 | `except Exception as e:` 후 `pass`만 하는 구간은 최소한 `_safe_print` 또는 로깅으로 한 줄 남기기 (선택). 디버깅 시 유리 | 선택 |

---

## 6. 기타

| # | 구분 | 내용 | 비고 |
|---|------|------|------|
| 6.1 | 문서 | 이 개선안 적용 내역을 본 문서 하단에 "적용 이력"으로 간단 기록 | 추적 |

---

## 적용 순서 제안

1. **2.1** data_json_io `return False` 제거(또는 명확화)
2. **1.2** app.py 타임아웃 상수화 + **1.1** 주석 보강
3. **4.1** shared_app_utils에 `format_bytes` 추가 후 bank/card/cash_app에서 사용
4. **5.1** safe_write_excel 공통화 (한 모듈로 이동 후 세 process_*에서 import)
5. **5.2** 선택 적용
6. **6.1** 적용 이력 갱신

---

## 승인 요청

위 항목 중 **적용해도 되는 번호**를 알려주세요.  
예: "2.1, 1.1, 1.2, 4.1만 진행" 또는 "전부 진행"

취소 희망 항목이 있으면 번호와 함께 "제외"라고 적어 주세요.

---

## 적용 이력 (readme 제외 승인 후 적용)

| 일자 | 적용 항목 | 비고 |
|------|-----------|------|
| 2025-02 | **2.1** | data_json_io.py: 도달 불가 `return False` 제거, 주석으로 설명 |
| 2025-02 | **1.1, 1.2** | app.py: `_SUBAPP_READ_TIMEOUT = 30` 상수화, `_read_app_file()` 서브프로세스 인자 주석 보강 |
| 2025-02 | **4.1** | shared_app_utils에 `format_bytes()` 추가, bank_app/card_app/cash_app에서 `_human` 제거 후 공통 사용 |
| 2025-02 | **5.1** | excel_io.py 신규 생성, `safe_write_excel()` 공통 정의. process_bank_data/process_card_data/process_cash_data에서 import(실패 시 로컬 폴백 유지) |
| 2025-02 | **6.1** | 본 적용 이력 기록 (docs 폴더, readme 제외) |
| 2025-02 | 순차 정리 | 불필요/미사용 코드·파일 점검: 삭제할 미사용 .py 파일 없음(진입점·공통·서브앱 모두 사용 중). `__pycache__` 디렉터리만 삭제(재생성 가능). readme 폴더는 규칙으로 미삭제. |
| 2025-02 | 리팩토링 | MyBank/bank_app: 분석 API 공통 패턴 추출. `_apply_bank_filter_for_analysis(df)` 헬퍼 추가, get_analysis_summary, get_analysis_by_category, get_analysis_by_category_group, get_analysis_by_month, get_analysis_by_category_monthly, get_analysis_by_bank에서 은행 필터 로직 공통화. |
